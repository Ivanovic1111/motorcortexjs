window.MotroCortex=function(A){var D=!1;A&&(D=A.hasOwnProperty("debug")?A.debug:!1);var B=[],s=[],t=[],n=this,E=["duration","easing","delay","complete","loop"],F=function(a,e){var f=1*a,h=1*e;e<=a&&(n.log("warn","When using @rand make sure the first parameter is always smaller than the first one. Reverting and proceeding"),h=1*a,f=1*e);return f+(h-f)*Math.random()},v=function(a){return 0==a.indexOf("+=")?"+=":0==a.indexOf("-=")?"-=":0==a.indexOf("-")?"-":""},w=function(a){return-1!==a.indexOf(")px",
    a.length-3)?"px":-1!==a.indexOf("%",a.length-1)?"%":""},y=function(a){a=a.split(".")[1].split(")")[0];return-1!=a.indexOf("%")?a.substring(0,a.length-1):a};this.trigger=function(a,e,f,h){var m=!0,b,c,k,g;0===arguments.length?(n.log("error","You must always include the event name to be triggered when invoking the MotorCortex.trigger function, as the first parameter in string format"),b=new z(null),m=!1):"string"!=typeof arguments[0]?(n.log("error","The first argument of the trigger function should always be a string representing the name of the event to be triggered. "+
    typeof arguments[0]+" passed on call."),b=new z(null),m=!1):1<arguments.length&&("object"===typeof arguments[1]&&null!=arguments[1]?arguments[1].target?(c=arguments[1],2<arguments.length&&("object"===typeof arguments[2]&&null!=arguments[2]?(k=arguments[2],3<arguments.length&&("function"===typeof arguments[3]?g=arguments[3]:(n.log("error","Unrecognized type of 4th parameter on trigger function of event "+a+". Function expected, "+typeof arguments[3]+" passed."),m=!1))):"function"===typeof arguments[2]?
    g=arguments[2]:(n.log("error","Unrecognized type of 3rd parameter on trigger function of event "+a+". Object or Function expected, "+typeof arguments[2]+" passed."),m=!1))):(k=arguments[1],2<arguments.length&&("function"!=typeof arguments[2]?(n.log("error","Unrecognized type of 3rd parameter on trigger function of event "+a+". Function expected, "+typeof arguments[2]+" passed."),m=!1):g=arguments[2])):"function"===typeof arguments[1]?g=arguments[1]:(n.log("error","Unrecognized type of 2nd parameter on trigger function of event "+
    a+". Object or Function expected, "+typeof arguments[1]+" passed."),m=!1));k||(k={});g||(g=function(){});m&&(s.hasOwnProperty(a)?(b=new z(s[a]),s[a].fire(c,k,g)):(b=new z(null),n.log("error","The event with name "+a+" has not been defined in any of the MSS files. It will be ignored!")));return b};var z=function(a){this.stop=function(){a?a.stop():n.log("error","You tried to stop a process that has not been executed.")}},x=function(a,e,f,h,m){this.loops=1;h||(h={attributes:{},options:{}});m||(m="");
    this.selectionFunction=this.createSelectionFunction(a,m);a=new RegExp(/^@globals\.[a-zA-Z0-9\-\_]*$/);h=JSON.parse(JSON.stringify(h));h.attributes={};for(var b in e.attributes)a.exec(e.attributes[b])&&(m=e.attributes[b].split(".")[1].trim(),B.hasOwnProperty("@"+m)?e.attributes[b]=B["@"+m]:n.log("error","The global variable "+e.attributes[b]+" is not defined. It will be ignored")),0<=E.indexOf(b)?"loop"!==b?h.options[b]=e.attributes[b]:this.loops=e.attributes[b]:h.attributes[b]=e.attributes[b];var c=
        function(){f.CallbackHandler.animationEnded()};b=Object.keys(e.children);e.attributes.hasOwnProperty("loop")&&f.setLoopTimes(e.attributes.loop);for(a=0;a<b.length;a++){var k=b[a];if("complete:trigger"==k)c=function(a,b){s[e.children[k].attributes.eventName].fire(a,b,function(){f.CallbackHandler.animationEnded()})};else if("complete"!=k)f.addReadyThread(new x(this.selectionFunction,e.children[k],f,h,k));else{m=1;e.children[k].attributes.hasOwnProperty("loop")&&(m=e.children[k].attributes.loop);var g=
        new u(m);g.addReadyThread(new x(this.selectionFunction,e.children.complete,g,h));c=function(a,b){g.fire(a,b,function(){f.CallbackHandler.animationEnded()})}}}this.createAnimationFunction(h,c);this.execute=function(a,b){this.animationFunction(a,b,c)}};x.prototype.createAnimationFunction=function(a){var e=new RegExp(/^@params\.[a-zA-Z0-9\-\_]*$|^-@params\.[a-zA-Z0-9\-\_]*$|^-=@params\.[a-zA-Z0-9\-\_]*$|^\+=@params\.[a-zA-Z0-9\-\_]*$|^@params\.[a-zA-Z0-9\-\_]*.%$|-^@params\.[a-zA-Z0-9\-\_]*.%$|^-=@params\.[a-zA-Z0-9\-\_]*.%$|^\+=@params\.[a-zA-Z0-9\-\_]*.%$|^\(@params\.[a-zA-Z0-9\-\_]*.\)px$|-^\(@params\.[a-zA-Z0-9\-\_]*.\)px$|^-=\(@params\.[a-zA-Z0-9\-\_]*.\)px$|^\+=\(@params\.[a-zA-Z0-9\-\_]*.\)px$/),
    f=new RegExp(/^@domel\.[a-zA-Z0-9\-\_]*$|^-@domel\.[a-zA-Z0-9\-\_]*$|^-=@domel\.[a-zA-Z0-9\-\_]*$|^\+=@domel\.[a-zA-Z0-9\-\_]*$|^@domel\.[a-zA-Z0-9\-\_]*.%$|^-@domel\.[a-zA-Z0-9\-\_]*.%$|^-=@domel\.[a-zA-Z0-9\-\_]*.%$|^\+=@domel\.[a-zA-Z0-9\-\_]*.%$|^\(@domel\.[a-zA-Z0-9\-\_]*.\)px$|^-\(@domel\.[a-zA-Z0-9\-\_]*.\)px$|^-=\(@domel\.[a-zA-Z0-9\-\_]*.\)px$|^\+=\(@domel\.[a-zA-Z0-9\-\_]*.\)px$/),h=new RegExp(/^@rand\( *?.+ *?, *?.+ *?\)$|^-@rand\( *?.+ *?, *?.+ *?\)$|^-=@rand\( *?.+ *?, *?.+ *?\)$|^\+=@rand\( *?.+ *?, *?.+ *?\)$|^@rand\( *?.+ *?, *?.+ *?\)%$|^-@rand\( *?.+ *?, *?.+ *?\)%$|^-=@rand\( *?.+ *?, *?.+ *?\)%$|^\+=@rand\( *?.+ *?, *?.+ *?\)%$|^@rand\( *?.+ *?, *?.+ *?\)px$|^-@rand\( *?.+ *?, *?.+ *?\)px$|^-=@rand\( *?.+ *?, *?.+ *?\)px$|^\+=@rand\( *?.+ *?, *?.+ *?\)px$/),
    m=!1;a.options.hasOwnProperty("duration")||(a.options.duration="0.3s",m=!0);this.animationFunction=function(b,c,k){var g=!1,p=!1,l=[],r=[],C=0,d;for(d in a.attributes)if(C+=1,e.exec(a.attributes[d])){var q=y(a.attributes[d]);c.hasOwnProperty(q)?a.attributes[d]=v(a.attributes[d])+c[q]+w(a.attributes[d]):n.log("error","The variable "+q+" was expected in the params object but is not present. It will be ignored")}else f.exec(a.attributes[d])?(l.push({pre:v(a.attributes[d]),units:w(a.attributes[d]),whichPart:"attributes",
    whichKey:d,byWhichAttr:y(a.attributes[d])}),g=!0):h.exec(a.attributes[d])&&(q=a.attributes[d].match(/([^()]+)/g)[1].split(","),r.push({pre:v(a.attributes[d]),units:w(a.attributes[d]),whichPart:"attributes",whichKey:d,byWhichRand:[1*q[0].trim(),1*q[1].trim()]}));for(d in a.options)e.exec(a.options[d])?(q=y(a.options[d]),c.hasOwnProperty(q)?a.options[d]=v(a.options[d])+c[q]+w(a.options[d]):n.log("error","The variable "+q+" was expected in the params object but is not present. It will be ignored")):
    f.exec(a.options[d])?(l.push({pre:v(a.options[d]),units:w(a.options[d]),whichPart:"options",whichKey:d,byWhichAttr:y(a.options[d])}),g=!0):h.exec(a.options[d])&&(p=!0,q=a.options[d].match(/([^()]+)/g)[1].split(","),r.push({pre:v(a.options[d]),units:w(a.options[d]),whichPart:"options",whichKey:d,byWhichRand:[1*q[0].trim(),1*q[1].trim()]}));if(0==C)return k(b,c),!0;m&&n.log("error","The duration has not been defined. The default (0.3s) will be used");if(g||p){var g=this.selectionFunction(a,b),s={numberOfElements:g.length,
    numberOfFinished:0,finished:function(){this.numberOfFinished+=1;this.numberOfFinished==this.numberOfElements&&k(b,c)}};g.each(function(){for(var d=JSON.parse(JSON.stringify(a)),b=0;b<l.length;b++)d[l[b].whichPart][l[b].whichKey]=l[b].pre+$(this).attr(l[b].byWhichAttr)+l[b].units;for(b=0;b<r.length;b++)d[r[b].whichPart][r[b].whichKey]=r[b].pre+F(r[b].byWhichRand[0],r[b].byWhichRand[1])+r[b].units;d.options.complete=function(){s.finished()};$(this).velocity(d.attributes,d.options)})}else a.options.complete=
    function(){k(b,c)},this.selectionFunction(a,b),this.selectionFunction(a,b).velocity(a.attributes,a.options)}};x.prototype.createSelectionFunction=function(a,e){var f=[{name:"index greater than",rxp:new RegExp(/^@index\ *?\>\ *?\d+$/),createSelectionFunction:function(a){return function(b){return":gt("+a.split(":")[1].trim()+")"}}},{name:"index less than",rxp:new RegExp(/^@index\ *?\<\ *?\d+$/),createSelectionFunction:function(a){return function(b){return":lt("+a.split(":")[1].trim()+")"}}},{name:"index less or equal to",
    rxp:new RegExp(/^@index\ *?\<\=\ *?\d+$/),createSelectionFunction:function(a){return function(b){return":lt("+a.split(":")[1].trim()+"):eq"+a.split(":")[1].trim()+")"}}},{name:"index greater or equal to",rxp:new RegExp(/^@index\ *?\>\=\ *?\d+$/),createSelectionFunction:function(a){return function(b){return":gt("+a.split(":")[1].trim()+"):eq"+a.split(":")[1].trim()+")"}}},{name:"index equals to",rxp:new RegExp(/^@index\ *?\={2}\ *?\d+$/),createSelectionFunction:function(a){return function(b){return":eq("+
    a.split(":")[1].trim()+")"}}},{name:"index odd",rxp:new RegExp(/^@index *?odd$/),createSelectionFunction:function(a){return function(a){return":odd"}}},{name:"index even",rxp:new RegExp(/^@index *?even$/),createSelectionFunction:function(a){return function(a){return":even"}}},{name:"index greater than parameter",rxp:new RegExp(/^@index\ *?\>\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),createSelectionFunction:function(a){return function(b){var d=a.split(":")[1].trim().split(".")[1];if(b.hasOwnProperty(d))return":gt("+
    b[d]+")";n.log("error","The expected params key "+d+" is not present. The selector will be ignored!");return""}}},{name:"index less than parameter",rxp:new RegExp(/^@index\ *?\<\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),createSelectionFunction:function(a){return function(b){var d=a.split(":")[1].trim().split(".")[1];if(b.hasOwnProperty(d))return":lt("+b[d]+")";n.log("error","The expected params key "+d+" is not present. The selector will be ignored!");return""}}},{name:"index less or equal to parameter",
    rxp:new RegExp(/^@index\ *?\<\=\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),createSelectionFunction:function(a){return function(b){var d=a.split(":")[1].trim().split(".")[1];if(b.hasOwnProperty(d))return":lt("+b[d]+"):eq"+b[d]+")";n.log("error","The expected params key "+d+" is not present. The selector will be ignored!");return""}}},{name:"index greater or equal to parameter",rxp:new RegExp(/^@index\ *?\>\=\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),createSelectionFunction:function(a){return function(b){var d=a.split(":")[1].trim().split(".")[1];
    if(b.hasOwnProperty(d))return":gt("+b[d]+"):eq"+b[d]+")";n.log("error","The expected params key "+d+" is not present. The selector will be ignored!");return""}}},{name:"index greater than parameter",rxp:new RegExp(/^@index\ *?\={2}\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),createSelectionFunction:function(a){return function(b){var d=a.split(":")[1].trim().split(".")[1];if(b.hasOwnProperty(d))return":eq("+b[d]+")";n.log("error","The expected params key "+d+" is not present. The selector will be ignored!");
    return""}}}],h=function(a){return function(b){return a}};if("[object Array]"===Object.prototype.toString.call(a)){for(var m=a.length,b=[],c,k=!1,g=0;g<m-1;g++)if(0!=a[g].indexOf("@"))"triggeringElement"==a[g]?k?n.log("warn","The triggering object filter seems to have been applied twice. The second directive will be ignored!"):(c=function(a){if(a)return $(a.target);n.log("error","You have included the 'triggeringElement' directive in your selection string on MSS, though you didn't pass the event object on the trigger function. The directive will be ignored");
    return $("*")},k=!0):"not(triggeringElement)"==a[g].replace(/ +?/g,"")?k?n.log("warn","The triggering object filter seems to have been applied twice. The second directive will be ignored!"):(c=function(a){if(a)return $("*").not($(a.target));n.log("error","You have included the 'triggeringElement' directive in your selection string on MSS, though you didn't pass the event object on the trigger function. The directive will be ignored");return $("*")},k=!0):b.push(h(a[g]));else{for(var p=!1,l=0;l<f.length;l++)if(f[l].rxp.exec(a[g])){b.push(f[l].createSelectionFunction(a[g]));
    p=!0;break}p||n.log("error","The selection "+a[g]+" seems to be invalid. It will be ignored!")}return function(a,h){for(var d="",f=0;f<b.length;f++)d+=b[f](a);d=c?c(h).filter(d):$(d);return""==e?d:d.find(e)}}return function(b,c){return""==e?a(b,c):a(b,c).find(e)}};var u=function(a,e){a||(a=1);this.threads=[];this.addTheThread=function(a,e){this.threads.push(new x(a,e,this))};this.addReadyThread=function(a){this.threads.push(a)};var f=this;this.CallbackHandler={numberOfExecutedLeafs:0,numberOfLoopsCompleted:0,
    eventId:e,init:function(a,e,b,c){this.numberOfThreads=a;this.callbackFunction=e;this.e=b;this.options=c;return this},setLoopTimes:function(e){a=e},reset:function(a){if(!a)return this.resetLoop(),this.numberOfLoopsCompleted=0,this},resetLoop:function(){this.numberOfExecutedLeafs=0},animationEnded:function(){this.numberOfExecutedLeafs+=1;if(this.numberOfExecutedLeafs==this.numberOfThreads)if(this.numberOfLoopsCompleted+=1,this.numberOfLoopsCompleted==a){if(null!=this.eventId&&null!=t[this.eventId]&&
        void 0!=t[this.eventId]){if("string"==typeof t[this.eventId])s[t[this.eventId]].fire(this.e,this.options,this.callbackFunction);else if(Array.isArray(t[this.eventId]))for(var e=0;e<t[this.eventId].length;e++)s[t[this.eventId][e]].fire(this.e,this.options,this.callbackFunction);return!0}this.callbackFunction()}else this.resetLoop(),f.fire(this.e,this.options,this.callbackFunction,!0)}}};u.prototype.setOverallEventCallback=function(a){this.parentEvent.setOverallEventCallback()};u.prototype.addThread=
    function(a,e){this.addTheThread(a,e)};u.prototype.fire=function(a,e,f,h){f||(f=function(){});e||(e={});this.CallbackHandler.init(this.threads.length,f,a,e,this.fire).reset(h);for(f=0;f<this.threads.length;f++)this.threads[f].execute(a,e)};u.prototype.stop=function(){};u.prototype.setLoopTimes=function(a){this.CallbackHandler.setLoopTimes(a)};var G=new function(){var a=this;a.init=function(){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.repeat=function(a){return Array(1+
    a).join(this)}};a.init();var e=/([^\:]+):([^\;]*);/,f=/(\/\*[\s\S]*?\*\/)|([^\s\;\{\}][^\;\{\}]*(?=\{))|(\})|([^\;\{\}]+\;(?!\s*\*\/))/gmi,h=function(a){return"undefined"==typeof a||0==a.length||null==a};a.toJSON=function(m){for(var b={children:{},attributes:{}},c=null,k=0,g={ordered:!1,comments:!1,stripComments:!1,split:!1};null!=(c=f.exec(m));)if(!h(c[1])&&g.comments)c=c[1].trim(),b[k++]=c;else if(h(c[2]))if(h(c[3]))h(c[4])||(c=c[4].trim(),(p=e.exec(c))?(c=p[1].trim(),p=p[2].trim(),g.ordered?(l=
{},l.name=c,l.value=p,l.type="attr",b[k++]=l):c in b.attributes?(l=b.attributes[c],l instanceof Array||(b.attributes[c]=[l]),b.attributes[c].push(p)):b.attributes[c]=p):b[k++]=c);else break;else{var c=c[2].trim(),p=a.toJSON(m,g);if(g.ordered){var l={};l.name=c;l.value=p;l.type="rule";b[k++]=l}else for(i in c=g.split?c.split(","):[c],c)if(l=c[i].trim(),l in b.children)for(var r in p.attributes)b.children[l].attributes[r]=p.attributes[r];else b.children[l]=p}return b}};this.log=function(a,e,f){D&&(e=
    "MotorCortex "+a+": "+e,f&&(console.log(f),e+=" | "+f),console[a](e))};this.loadMSS=function(a,e){var f,h,m=this;if(!window.jQuery)return this.log("error","jQuery has not been loaded. Please load jQuery before MotorCortex.loadMSS invocation"),this.execute=function(){this.log("error","jQuery has not been loaded")},!1;var b;if("[object Array]"!=Object.prototype.toString.call(a))if("string"===typeof a)b=[a];else return this.log("error","Unidentified / Unsupported files attribute type. Currently supported only array and string"),
    !1;else b=a;var c=b.length;f=0;h=function(){f+=1;f===c&&e()};for(var k=0;k<c;k++){var g=b[k];$.ajax({url:g,type:"GET",async:!0,success:function(a){a=G.toJSON(a);var b=new RegExp(/^[a-zA-Z0-9\.\-\_]+\:callback$/),e=new RegExp(/^@[a-zA-Z0-9\.\-\_]*?/),c;for(c in a.attributes)a.attributes.hasOwnProperty(c)&&("@index"==c||"@params"==c||"@domel"==c?n.log("warn","The keywords/parameter names @index, @params and @domel are reserved by MotorCortex and cannot be used as a global variable's name. The declared global "+
    c+" will be ignored!"):e.exec(c)?B[c]=a.attributes[c]:n.log("warn","The property "+c+" should begin with the character '@'. It will be ignored!"));for(c in a.children)if(b.exec(c)&&(e=c.split(":"),t[e[0]]=a.children[c].attributes.eventName),e=c.split(":"),2>e.length)n.log("error","The MC selection and event part "+c+" is not valid. Each MC selection string should consist by least a selection string and an event name separated by the ':' character.");else if(s.hasOwnProperty(e[e.length-1]))d.addThread(e,
    a.children[c]);else{d=1;a.children[c].attributes.hasOwnProperty("loop")&&(d=a.children[c].attributes.loop);var d=new u(d,e[e.length-1]);d.addThread(e,a.children[c]);s[e[e.length-1]]=d}h()},error:function(a,b,c){m.log("error","The MSS file "+g+" seems to be missing",c)}})}}};