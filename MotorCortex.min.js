window.MotroCortex=function(y){var B=!1;y&&(B=y.hasOwnProperty("debug")?y.debug:!1);var z=[],r=[],l=this,C=["duration","easing","delay","complete","loop"],D=function(a,c){var f=1*a,m=1*c;c<=a&&(l.log("warn","When using @rand make sure the first parameter is always smaller than the first one. Reverting and proceeding"),m=1*a,f=1*c);return f+(m-f)*Math.random()},s=function(a){return 0==a.indexOf("+=")?"+=":0==a.indexOf("-=")?"-=":0==a.indexOf("-")?"-":""},t=function(a){return-1!==a.indexOf(")px",a.length-
    3)?"px":-1!==a.indexOf("%",a.length-1)?"%":""},w=function(a){a=a.split(".")[1].split(")")[0];return-1!=a.indexOf("%")?a.substring(0,a.length-1):a};this.trigger=function(a,c,f,m){var g=!0,b,e,n,k;0===arguments.length?(l.log("error","You must always include the event name to be triggered when invoking the MotorCortex.trigger function, as the first parameter in string format"),b=new x(null),g=!1):"string"!=typeof arguments[0]?(l.log("error","The first argument of the trigger function should always be a string representing the name of the event to be triggered. "+
    typeof arguments[0]+" passed on call."),b=new x(null),g=!1):1<arguments.length&&("object"===typeof arguments[1]&&null!=arguments[1]?arguments[1].target?(e=arguments[1],2<arguments.length&&("object"===typeof arguments[2]&&null!=arguments[2]?(n=arguments[2],3<arguments.length&&("function"===typeof arguments[3]?k=arguments[3]:(l.log("error","Unrecognized type of 4th parameter on trigger function of event "+a+". Function expected, "+typeof arguments[3]+" passed."),g=!1))):"function"===typeof arguments[2]?
    k=arguments[2]:(l.log("error","Unrecognized type of 3rd parameter on trigger function of event "+a+". Object or Function expected, "+typeof arguments[2]+" passed."),g=!1))):(n=arguments[1],2<arguments.length&&("function"!=typeof arguments[2]?(l.log("error","Unrecognized type of 3rd parameter on trigger function of event "+a+". Function expected, "+typeof arguments[2]+" passed."),g=!1):k=arguments[2])):"function"===typeof arguments[1]?k=arguments[1]:(l.log("error","Unrecognized type of 2nd parameter on trigger function of event "+
    a+". Object or Function expected, "+typeof arguments[1]+" passed."),g=!1));n||(n={});k||(k=function(){});g&&(r.hasOwnProperty(a)?(b=new x(r[a]),r[a].fire(e,n,k)):(b=new x(null),l.log("error","The event with name "+a+" has not been defined in any of the MSS files. It will be ignored!")));return b};var x=function(a){this.stop=function(){a?a.stop():l.log("error","You tried to stop a process that has not been executed.")}},u=function(a,c,f,m,g){this.loops=1;m||(m={attributes:{},options:{}});g||(g="");
    this.selectionFunction=this.createSelectionFunction(a,g);a=new RegExp(/^@globals\.[a-zA-Z0-9\-\_]*$/);m=JSON.parse(JSON.stringify(m));m.attributes={};for(var b in c.attributes)a.exec(c.attributes[b])&&(g=c.attributes[b].split(".")[1].trim(),z.hasOwnProperty("@"+g)?c.attributes[b]=z["@"+g]:l.log("error","The global variable "+c.attributes[b]+" is not defined. It will be ignored")),0<=C.indexOf(b)?"loop"!==b?m.options[b]=c.attributes[b]:this.loops=c.attributes[b]:m.attributes[b]=c.attributes[b];var e=
        function(){f.CallbackHandler.animationEnded()};b=Object.keys(c.children);for(a=0;a<b.length;a++)if(g=b[a],"complete"!=g)f.addReadyThread(new u(this.selectionFunction,c.children[g],f,m,g));else{var n=1;c.children[g].attributes.hasOwnProperty("loop")&&(n=c.children[g].attributes.loop);var k=new v(n);k.addReadyThread(new u(this.selectionFunction,c.children.complete,k,m));e=function(a,b){k.fire(a,b,function(){f.CallbackHandler.animationEnded()})}}this.createAnimationFunction(m,e);this.execute=function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               b){this.animationFunction(a,b,e)}};u.prototype.createAnimationFunction=function(a){var c=new RegExp(/^@params\.[a-zA-Z0-9\-\_]*$|^-@params\.[a-zA-Z0-9\-\_]*$|^-=@params\.[a-zA-Z0-9\-\_]*$|^\+=@params\.[a-zA-Z0-9\-\_]*$|^@params\.[a-zA-Z0-9\-\_]*.%$|-^@params\.[a-zA-Z0-9\-\_]*.%$|^-=@params\.[a-zA-Z0-9\-\_]*.%$|^\+=@params\.[a-zA-Z0-9\-\_]*.%$|^\(@params\.[a-zA-Z0-9\-\_]*.\)px$|-^\(@params\.[a-zA-Z0-9\-\_]*.\)px$|^-=\(@params\.[a-zA-Z0-9\-\_]*.\)px$|^\+=\(@params\.[a-zA-Z0-9\-\_]*.\)px$/),f=new RegExp(/^@domel\.[a-zA-Z0-9\-\_]*$|^-@domel\.[a-zA-Z0-9\-\_]*$|^-=@domel\.[a-zA-Z0-9\-\_]*$|^\+=@domel\.[a-zA-Z0-9\-\_]*$|^@domel\.[a-zA-Z0-9\-\_]*.%$|^-@domel\.[a-zA-Z0-9\-\_]*.%$|^-=@domel\.[a-zA-Z0-9\-\_]*.%$|^\+=@domel\.[a-zA-Z0-9\-\_]*.%$|^\(@domel\.[a-zA-Z0-9\-\_]*.\)px$|^-\(@domel\.[a-zA-Z0-9\-\_]*.\)px$|^-=\(@domel\.[a-zA-Z0-9\-\_]*.\)px$|^\+=\(@domel\.[a-zA-Z0-9\-\_]*.\)px$/),
    m=new RegExp(/^@rand\( *?.+ *?, *?.+ *?\)$|^-@rand\( *?.+ *?, *?.+ *?\)$|^-=@rand\( *?.+ *?, *?.+ *?\)$|^\+=@rand\( *?.+ *?, *?.+ *?\)$|^@rand\( *?.+ *?, *?.+ *?\)%$|^-@rand\( *?.+ *?, *?.+ *?\)%$|^-=@rand\( *?.+ *?, *?.+ *?\)%$|^\+=@rand\( *?.+ *?, *?.+ *?\)%$|^@rand\( *?.+ *?, *?.+ *?\)px$|^-@rand\( *?.+ *?, *?.+ *?\)px$|^-=@rand\( *?.+ *?, *?.+ *?\)px$|^\+=@rand\( *?.+ *?, *?.+ *?\)px$/);a.options.hasOwnProperty("duration")||(a.options.duration="0.3s",l.log("error","The duration has not been defined. The default (0.3s) will be used"));
    this.animationFunction=function(g,b,e){var n=!1,k=!1,p=[],d=[],A=0,h;for(h in a.attributes)if(A+=1,c.exec(a.attributes[h])){var q=w(a.attributes[h]);b.hasOwnProperty(q)?a.attributes[h]=s(a.attributes[h])+b[q]+t(a.attributes[h]):l.log("error","The variable "+q+" was expected in the params object but is not present. It will be ignored")}else f.exec(a.attributes[h])?(p.push({pre:s(a.attributes[h]),units:t(a.attributes[h]),whichPart:"attributes",whichKey:h,byWhichAttr:w(a.attributes[h])}),n=!0):m.exec(a.attributes[h])&&
        (q=a.attributes[h].match(/([^()]+)/g)[1].split(","),d.push({pre:s(a.attributes[h]),units:t(a.attributes[h]),whichPart:"attributes",whichKey:h,byWhichRand:[1*q[0].trim(),1*q[1].trim()]}));for(h in a.options)c.exec(a.options[h])?(q=w(a.options[h]),b.hasOwnProperty(q)?a.options[h]=s(a.options[h])+b[q]+t(a.options[h]):l.log("error","The variable "+q+" was expected in the params object but is not present. It will be ignored")):f.exec(a.options[h])?(p.push({pre:s(a.options[h]),units:t(a.options[h]),whichPart:"options",
        whichKey:h,byWhichAttr:w(a.options[h])}),n=!0):m.exec(a.options[h])&&(k=!0,q=a.options[h].match(/([^()]+)/g)[1].split(","),d.push({pre:s(a.options[h]),units:t(a.options[h]),whichPart:"options",whichKey:h,byWhichRand:[1*q[0].trim(),1*q[1].trim()]}));if(0==A)return e(g,b),!0;if(n||k){var n=this.selectionFunction(a,g),r={numberOfElements:n.length,numberOfFinished:0,finished:function(){this.numberOfFinished+=1;this.numberOfFinished==this.numberOfElements&&e(g,b)}};n.each(function(){for(var h=JSON.parse(JSON.stringify(a)),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   b=0;b<p.length;b++)h[p[b].whichPart][p[b].whichKey]=p[b].pre+$(this).attr(p[b].byWhichAttr)+p[b].units;for(b=0;b<d.length;b++)h[d[b].whichPart][d[b].whichKey]=d[b].pre+D(d[b].byWhichRand[0],d[b].byWhichRand[1])+d[b].units;h.options.complete=function(){r.finished()};$(this).velocity(h.attributes,h.options)})}else a.options.complete=function(){e(g,b)},this.selectionFunction(a,g),this.selectionFunction(a,g).velocity(a.attributes,a.options)}};u.prototype.createSelectionFunction=function(a,c){var f=[{name:"index greater than",
    rxp:new RegExp(/^@index\ *?\>\ *?\d+$/),createSelectionFunction:function(a){return function(b){return":gt("+a.split(":")[1].trim()+")"}}},{name:"index less than",rxp:new RegExp(/^@index\ *?\<\ *?\d+$/),createSelectionFunction:function(a){return function(b){return":lt("+a.split(":")[1].trim()+")"}}},{name:"index less or equal to",rxp:new RegExp(/^@index\ *?\<\=\ *?\d+$/),createSelectionFunction:function(a){return function(b){return":lt("+a.split(":")[1].trim()+"):eq"+a.split(":")[1].trim()+")"}}},
    {name:"index greater or equal to",rxp:new RegExp(/^@index\ *?\>\=\ *?\d+$/),createSelectionFunction:function(a){return function(b){return":gt("+a.split(":")[1].trim()+"):eq"+a.split(":")[1].trim()+")"}}},{name:"index equals to",rxp:new RegExp(/^@index\ *?\={2}\ *?\d+$/),createSelectionFunction:function(a){return function(b){return":eq("+a.split(":")[1].trim()+")"}}},{name:"index odd",rxp:new RegExp(/^@index *?odd$/),createSelectionFunction:function(a){return function(a){return":odd"}}},{name:"index even",
        rxp:new RegExp(/^@index *?even$/),createSelectionFunction:function(a){return function(a){return":even"}}},{name:"index greater than parameter",rxp:new RegExp(/^@index\ *?\>\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),createSelectionFunction:function(a){return function(b){var d=a.split(":")[1].trim().split(".")[1];if(b.hasOwnProperty(d))return":gt("+b[d]+")";l.log("error","The expected params key "+d+" is not present. The selector will be ignored!");return""}}},{name:"index less than parameter",rxp:new RegExp(/^@index\ *?\<\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),
        createSelectionFunction:function(a){return function(b){var d=a.split(":")[1].trim().split(".")[1];if(b.hasOwnProperty(d))return":lt("+b[d]+")";l.log("error","The expected params key "+d+" is not present. The selector will be ignored!");return""}}},{name:"index less or equal to parameter",rxp:new RegExp(/^@index\ *?\<\=\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),createSelectionFunction:function(a){return function(b){var d=a.split(":")[1].trim().split(".")[1];if(b.hasOwnProperty(d))return":lt("+b[d]+"):eq"+
        b[d]+")";l.log("error","The expected params key "+d+" is not present. The selector will be ignored!");return""}}},{name:"index greater or equal to parameter",rxp:new RegExp(/^@index\ *?\>\=\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),createSelectionFunction:function(a){return function(b){var d=a.split(":")[1].trim().split(".")[1];if(b.hasOwnProperty(d))return":gt("+b[d]+"):eq"+b[d]+")";l.log("error","The expected params key "+d+" is not present. The selector will be ignored!");return""}}},{name:"index greater than parameter",
        rxp:new RegExp(/^@index\ *?\={2}\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),createSelectionFunction:function(a){return function(b){var d=a.split(":")[1].trim().split(".")[1];if(b.hasOwnProperty(d))return":eq("+b[d]+")";l.log("error","The expected params key "+d+" is not present. The selector will be ignored!");return""}}}],m=function(a){return function(b){return a}};if("[object Array]"===Object.prototype.toString.call(a)){for(var g=a.length,b=[],e,n=!1,k=0;k<g-1;k++)if(0!=a[k].indexOf("@"))"triggeringElement"==
    a[k]?n?l.log("warn","The triggering object filter seems to have been applied twice. The second directive will be ignored!"):(e=function(a){if(a)return $(a.target);l.log("error","You have included the 'triggeringElement' directive in your selection string on MSS, though you didn't pass the event object on the trigger function. The directive will be ignored");return $("*")},n=!0):"not(triggeringElement)"==a[k].replace(/ +?/g,"")?n?l.log("warn","The triggering object filter seems to have been applied twice. The second directive will be ignored!"):
    (e=function(a){if(a)return $("*").not($(a.target));l.log("error","You have included the 'triggeringElement' directive in your selection string on MSS, though you didn't pass the event object on the trigger function. The directive will be ignored");return $("*")},n=!0):b.push(m(a[k]));else{for(var p=!1,d=0;d<f.length;d++)if(f[d].rxp.exec(a[k])){b.push(f[d].createSelectionFunction(a[k]));p=!0;break}p||l.log("error","The selection "+a[k]+" seems to be invalid. It will be ignored!")}return function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        d){for(var f="",g=0;g<b.length;g++)f+=b[g](a);f=e?e(d).filter(f):$(f);return""==c?f:f.find(c)}}return function(b,d){return""==c?a(b,d):a(b,d).find(c)}};var v=function(a){a||(a=1);this.threads=[];this.addTheThread=function(a,c){this.threads.push(new u(a,c,this))};this.addReadyThread=function(a){this.threads.push(a)};var c=this;this.CallbackHandler={numberOfExecutedLeafs:0,numberOfLoopsCompleted:0,init:function(a,c,g,b){this.numberOfThreads=a;this.callbackFunction=c;this.e=g;this.options=b;return this},
    reset:function(a){if(!a)return this.resetLoop(),this.numberOfLoopsCompleted=0,this},resetLoop:function(){this.numberOfExecutedLeafs=0},animationEnded:function(){this.numberOfExecutedLeafs+=1;this.numberOfExecutedLeafs==this.numberOfThreads&&(this.numberOfLoopsCompleted+=1,this.numberOfLoopsCompleted==a?this.callbackFunction():(this.resetLoop(),c.fire(this.e,this.options,this.callbackFunction,!0)))}}};v.prototype.addThread=function(a,c){this.addTheThread(a,c)};v.prototype.fire=function(a,c,f,m){f||
(f=function(){});c||(c={});this.CallbackHandler.init(this.threads.length,f,a,c,this.fire).reset(m);for(f=0;f<this.threads.length;f++)this.threads[f].execute(a,c)};v.prototype.stop=function(){};var E=new function(){var a=this;a.init=function(){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.repeat=function(a){return Array(1+a).join(this)}};a.init();var c=/([^\:]+):([^\;]*);/,f=/(\/\*[\s\S]*?\*\/)|([^\s\;\{\}][^\;\{\}]*(?=\{))|(\})|([^\;\{\}]+\;(?!\s*\*\/))/gmi,
    m=function(a){return"undefined"==typeof a||0==a.length||null==a};a.toJSON=function(g){for(var b={children:{},attributes:{}},e=null,n=0,k={ordered:!1,comments:!1,stripComments:!1,split:!1};null!=(e=f.exec(g));)if(!m(e[1])&&k.comments)e=e[1].trim(),b[n++]=e;else if(m(e[2]))if(m(e[3]))m(e[4])||(e=e[4].trim(),(p=c.exec(e))?(e=p[1].trim(),p=p[2].trim(),k.ordered?(d={},d.name=e,d.value=p,d.type="attr",b[n++]=d):e in b.attributes?(d=b.attributes[e],d instanceof Array||(b.attributes[e]=[d]),b.attributes[e].push(p)):
    b.attributes[e]=p):b[n++]=e);else break;else{var e=e[2].trim(),p=a.toJSON(g,k);if(k.ordered){var d={};d.name=e;d.value=p;d.type="rule";b[n++]=d}else for(i in e=k.split?e.split(","):[e],e)if(d=e[i].trim(),d in b.children)for(var l in p.attributes)b.children[d].attributes[l]=p.attributes[l];else b.children[d]=p}return b}};this.log=function(a,c,f){B&&(c="MotorCortex "+a+": "+c,f&&(console.log(f),c+=" | "+f),console[a](c))};this.loadMSS=function(a,c){var f,m,g=this;if(!window.jQuery)return this.log("error",
    "jQuery has not been loaded. Please load jQuery before MotorCortex.loadMSS invocation"),this.execute=function(){this.log("error","jQuery has not been loaded")},!1;var b;if("[object Array]"!=Object.prototype.toString.call(a))if("string"===typeof a)b=[a];else return this.log("error","Unidentified / Unsupported files attribute type. Currently supported only array and string"),!1;else b=a;var e=b.length;f=0;m=function(){f+=1;f===e&&c()};for(var n=0;n<e;n++){var k=b[n];$.ajax({url:k,type:"GET",async:!0,
    success:function(a){a=E.toJSON(a);for(var b in a.attributes){var c=new RegExp(/^@[a-zA-Z0-9\.\-\_]*?/);a.attributes.hasOwnProperty(b)&&("@index"==b||"@params"==b||"@domel"==b?l.log("warn","The keywords/parameter names @index, @params and @domel are reserved by MotorCortex and cannot be used as a global variable's name. The declared global "+b+" will be ignored!"):c.exec(b)?z[b]=a.attributes[b]:l.log("warn","The property "+b+" should begin with the character '@'. It will be ignored!"))}for(b in a.children)if(c=
        b.split(":"),2>c.length)l.log("error","The MC selection and event part "+b+" is not valid. Each MC selection string should consist by least a selection string and an event name separated by the ':' character.");else if(r.hasOwnProperty(c[c.length-1]))e.addThread(c,a.children[b]);else{e=1;a.children[b].attributes.hasOwnProperty("loop")&&(e=a.children[b].attributes.loop);var e=new v(e);e.addThread(c,a.children[b]);r[c[c.length-1]]=e}m()},error:function(a,b,c){g.log("error","The MSS file "+k+" seems to be missing",
        c)}})}}};